<!DOCTYPE html>
<html lang="id" dir="ltr">

<script src="assets/theme.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
</script>


<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Dashboard Guru</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: { 50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a' },
            secondary: { 100:'#dcfce7',500:'#22c55e',600:'#16a34a' }
          },
          fontFamily: { arabic: ['Amiri','Scheherazade New','serif'] }
        }
      }
    }
  </script>



</head>

<body class="min-h-screen flex flex-col bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-100">


  <!-- ===== HEADER DASHBOARD GURU ===== -->
  <header class="sticky top-0 z-50 w-full bg-emerald-700/95 dark:bg-slate-900/95 backdrop-blur-md text-white shadow-lg border-b border-white/10 transition-all">
  <div class="max-w-7xl mx-auto px-4 md:px-6 py-3.5 flex items-center justify-between">
    
    <div class="flex items-center gap-2 md:gap-4">
      <div class="p-2 bg-white/10 rounded-xl shadow-inner">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 md:w-7 md:h-7 text-emerald-100" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
        </svg>
      </div>
      <div class="flex flex-col">
        <span class="text-lg md:text-xl font-black tracking-tighter leading-none italic uppercase">Tarbiyyat</span>
        <span class="text-[9px] md:text-[10px] font-bold tracking-[0.2em] text-emerald-200 uppercase leading-none mt-1 text-center sm:text-left">al-Lughah</span>
      </div>
    </div>

    <div class="flex items-center gap-3 md:gap-6">
      
      <div class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-white/10 rounded-lg border border-white/10">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-300"></span>
        </span>
        <span class="text-[10px] font-black uppercase tracking-widest text-emerald-50">Sistem Informasi Guru</span>
      </div>

      <a href="index.html" 
         class="text-[11px] md:text-sm font-bold bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl border border-white/20 transition-all active:scale-95">
        Beranda
      </a>

      <button id="darkToggle"
        class="flex items-center justify-center w-9 h-9 md:w-10 md:h-10 rounded-xl 
               bg-white text-emerald-700 dark:bg-slate-800 dark:text-emerald-400
               transition-all active:scale-90 text-base shadow-sm hover:shadow-md"
        title="Ganti Tema">
        üåô
      </button>
    </div>

  </div>
</header>

  <!-- ===== MAIN (PENYANGGA FOOTER) ===== -->
  <main class="flex-grow flex items-center justify-center">

    <!-- ===============================
         LOGIN GURU
    ================================ -->
    <section id="login-section" class="w-full max-w-2xl mx-auto px-0 sm:px-4 py-8 md:py-24">
  <article class="bg-white dark:bg-slate-800 border-x-0 sm:border border-slate-200 dark:border-slate-700 rounded-none sm:rounded-[2rem] shadow-2xl overflow-hidden transition-all">
    
    <div class="bg-gradient-to-br from-emerald-600 to-emerald-800 text-white py-14 px-6 text-center relative overflow-hidden">
      <div class="absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-emerald-400/10 rounded-full blur-3xl"></div>
      
      <div class="relative z-10">
        <div class="inline-flex items-center justify-center w-14 h-14 bg-white/20 rounded-2xl backdrop-blur-md mb-4 shadow-xl">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
        </div>
        <h3 class="text-2xl md:text-3xl font-black tracking-tight italic uppercase">Login Dashboard Guru</h3>
        <p class="text-emerald-100 text-[10px] md:text-xs mt-2 font-bold uppercase tracking-[0.4em] opacity-80">Sistem Manajemen Pembelajaran</p>
      </div>
    </div>

    <div class="p-8 md:p-12 space-y-8">
      
      <div class="grid grid-cols-1 gap-6">
        <div class="space-y-2">
          <label class="text-[11px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest ml-1">ID / Email Resmi Guru</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-4 flex items-center text-emerald-600/50">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            </span>
            <input id="emailGuru" type="email" placeholder="contoh: guru@tarbiyyat.com" 
                   class="w-full pl-12 pr-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl 
                          text-slate-800 dark:text-white text-base focus:ring-4 focus:ring-emerald-500/10 focus:border-emerald-500 focus:outline-none transition-all appearance-none">
          </div>
        </div>

        <div class="space-y-2">
          <label class="text-[11px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest ml-1">Kata Sandi Dashboard</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-4 flex items-center text-emerald-600/50">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
            </span>
            <input id="passwordGuru" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                   class="w-full pl-12 pr-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl 
                          text-slate-800 dark:text-white text-base focus:ring-4 focus:ring-emerald-500/10 focus:border-emerald-500 focus:outline-none transition-all appearance-none">
          </div>
        </div>
      </div>

      <div class="pt-2">
        <button id="btnLoginGuru" 
                class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-4 md:py-5 rounded-2xl font-black uppercase tracking-widest 
                       shadow-xl shadow-emerald-500/30 transition-all active:scale-[0.97] flex items-center justify-center gap-3 text-sm md:text-base">
          <span>Otorisasi Masuk</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
        </button>
      </div>

      <div id="loginError" class="hidden">
        <div class="flex items-center gap-3 p-4 rounded-2xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/50">
          <div class="bg-red-500 text-white rounded-full p-1.5 shadow-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
          </div>
          <p class="text-xs font-bold text-red-700 dark:text-red-400 italic">Otoritas ditolak. Email atau password salah.</p>
        </div>
      </div>

    </div>

    <div class="px-8 py-6 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-700 text-center">
      <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-relaxed">
        Sistem Keamanan Terpadu <br class="sm:hidden"> Tarbiyyat al-Lughah &copy; 2026
      </p>
    </div>

  </article>
    </section>

    <!-- ===============================
         DASHBOARD TUGAS (HIDDEN DEFAULT)
    ================================ -->
    <section id="dashboard-section" class="w-full max-w-7xl mx-auto px-0 sm:px-6 py-4 sm:py-10 hidden">
  
  <article class="bg-white dark:bg-slate-800 border-x-0 sm:border border-slate-200 dark:border-slate-700 rounded-none sm:rounded-[2.5rem] shadow-2xl overflow-hidden transition-all">
    
    <div class="bg-gradient-to-r from-emerald-600 via-emerald-700 to-emerald-800 text-white px-6 py-8 md:px-10 md:py-12 flex flex-col md:flex-row md:items-center md:justify-between gap-6 relative overflow-hidden">
      
      <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-20 -mt-20 blur-3xl"></div>
      
      <div class="relative z-10 flex flex-col md:flex-row items-center gap-5">
        <div class="p-4 bg-white/20 rounded-2xl backdrop-blur-md shadow-lg border border-white/20">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
        </div>
        <div class="text-center md:text-left">
          <h3 class="text-2xl md:text-3xl font-black tracking-tight italic uppercase">Panel Utama Guru</h3>
          <div class="flex flex-col sm:flex-row items-center gap-2 mt-1">
            <span class="text-xs font-bold text-emerald-100 uppercase tracking-widest bg-emerald-900/30 px-3 py-1 rounded-full border border-emerald-500/30">Manajemen Data Siswa</span>
            <span class="hidden sm:inline text-emerald-300">‚Ä¢</span>
            <p class="text-xs text-emerald-100/80 font-medium">Pantau perkembangan maharah qira'ah secara real-time</p>
          </div>
        </div>
      </div>

      <div class="relative z-10 flex justify-center md:justify-end">
        <button id="btnLogout"
                class="group flex items-center gap-2 bg-white/10 hover:bg-red-500 text-white px-6 py-3 rounded-xl text-sm font-black uppercase tracking-widest border border-white/20 transition-all active:scale-95 shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          Keluar
        </button>
      </div>
    </div>

        <!-- DASHBOARD TUGAS -->
        <div class="mt-8 mb-20 px-1">
  
  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center gap-3">
      <div class="p-2 bg-pink-100 dark:bg-pink-900/30 rounded-lg text-pink-600 dark:text-pink-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></svg>
      </div>
      <div>
        <h3 class="text-xl font-bold text-slate-800 dark:text-white">
          Daftar Pengumpulan Tugas
        </h3>
        <p class="text-xs text-slate-400 dark:text-slate-500">
          Memantau file tugas yang dikirim oleh siswa.
        </p>
      </div>
    </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[20px]">No</th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[150px]">Nama Siswa</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas</th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[200px]">Catatan Siswa</th>
            <th class="px-6 py-4 whitespace-nowrap text-center">File Tugas</th>
            <th class="px-6 py-4 whitespace-nowrap">Waktu Kirim</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Aksi</th>
          </tr>
        </thead>

        <tbody id="tabelSubmissions" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          
          <tr>
            <td colspan="7" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-pink-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Sedang memuat data tugas...</span>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>

    <div class="px-6 py-4 bg-slate-50 dark:bg-slate-900/30 border-t border-slate-100 dark:border-slate-700 flex justify-between items-center">
      <span class="text-xs text-slate-400">Menampilkan data terbaru</span>
    </div>

  </div>
        </div>


<!-- ===============================
     MANAJEMEN SISWA
=============================== -->
<div class="mt-8 mb-20 px-1">
  
  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg text-cyan-600 dark:text-cyan-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-800 dark:text-white">
            Manajemen Siswa
          </h3>
          <p class="text-xs text-slate-400 dark:text-slate-500">
            Daftar seluruh siswa yang terdaftar dalam sistem.
          </p>
        </div>
      </div>

      </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[20px]">No</th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[200px]">Nama Lengkap</th>
            <th class="px-6 py-4 whitespace-nowrap">NISN</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas</th>
            <th class="px-6 py-4 whitespace-nowrap text-center">Gender</th>
            <th class="px-6 py-4 whitespace-nowrap text-center">Status</th>
            <th class="px-6 py-4 whitespace-nowrap text-center">Aksi</th>
          </tr>
        </thead>

        <tbody id="tabelSiswa" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          
          <tr>
            <td colspan="7" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-cyan-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Memuat data siswa...</span>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>
    
    <div class="px-6 py-4 bg-slate-50 dark:bg-slate-900/30 border-t border-slate-100 dark:border-slate-700">
      <p class="text-xs text-slate-400 text-center sm:text-left">
        Menampilkan seluruh data siswa aktif.
      </p>
    </div>

  </div>
</div>


<!-- TEMPAT DISKUSI -->

<div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 mb-6 overflow-hidden ml-4 mr-4">

  <div 
    onclick="toggleDiscussion()"
    class="cursor-pointer px-5 py-4 bg-slate-50 dark:bg-slate-900/50 border-b border-transparent hover:bg-slate-100 dark:hover:bg-slate-900 transition-colors flex justify-between items-center"
  >
    <div class="flex items-center gap-3">
      <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse ring-2 ring-green-200 dark:ring-green-900"></div>
      <div>
        <h3 class="font-bold text-slate-700 dark:text-slate-200 select-none text-base">Ruang Diskusi</h3>
        <p class="text-[10px] text-slate-400 font-normal md:hidden">Klik untuk buka/tutup</p>
      </div>
      <span class="text-xs text-slate-400 font-normal ml-2 hidden md:inline bg-slate-200 dark:bg-slate-700 px-2 py-0.5 rounded-full">Klik untuk buka</span>
    </div>

    <div class="flex items-center gap-3">
      <button
        id="btnClearDiscussion"
        onclick="event.stopPropagation();" 
        class="hidden group flex items-center gap-1.5 text-xs font-medium px-3 py-1.5 rounded-full
               bg-red-50 text-red-600 hover:bg-red-100 border border-red-100
               dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30 transition-all z-10 shadow-sm">
        <span class="group-hover:rotate-12 transition-transform">üßπ</span> 
        <span class="hidden sm:inline">Bersihkan</span>
      </button>

      <svg id="chevronIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" 
           class="w-5 h-5 text-slate-400 transition-transform duration-300 transform">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
      </svg>
    </div>
  </div>

  <div id="discussionContent" class="hidden flex flex-col transition-all duration-300 ease-in-out border-t border-slate-200 dark:border-slate-700">
    
    <div
      id="discussionFeed"
      class="h-[60vh] md:h-[500px] overflow-y-auto p-4 space-y-3 relative
             bg-[#eef1f5] dark:bg-[#0b141a] 
             scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-600"
    >
      <div class="flex h-full items-center justify-center opacity-60">
        <p class="text-slate-400 text-sm italic bg-slate-200/50 dark:bg-slate-800/50 px-3 py-1 rounded-full shadow-sm">
            Memuat diskusi...
        </p>
      </div>
    </div>

    <div class="p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700">
      <div class="flex items-end gap-2 relative">
        
        <textarea
          id="discussionInput"
          rows="1"
          placeholder="Ketik pesan sebagai Guru..."
          class="flex-1 max-h-32 min-h-[45px] py-3 px-4 rounded-2xl resize-none
                 bg-slate-100 dark:bg-slate-700 
                 text-slate-800 dark:text-white placeholder-slate-400
                 border-0 focus:ring-2 focus:ring-blue-500/50 outline-none shadow-inner"
          style="field-sizing: content;" 
        ></textarea>

        <button
          id="btnPostDiscussion"
          type="button"
          class="flex-shrink-0 w-[45px] h-[45px] flex items-center justify-center rounded-full
                 bg-blue-600 hover:bg-blue-700 text-white shadow-md
                 transform active:scale-95 transition-all"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 ml-0.5">
            <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
          </svg>
        </button>

      </div>
      <div class="text-[10px] text-slate-400 mt-1 ml-2 dark:text-slate-500">
        Tekan enter untuk mengirim
      </div>
    </div>

  </div>
</div>


<!-- TABEL SESI BELAJAR -->
<div class="mt-8">
  
  <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-900/50">
      <h3 class="text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2">
        <span>üìã</span> Daftar Sesi Harian
      </h3>
      </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-semibold text-slate-500 dark:text-slate-400">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[10px]">#</th>
            <th class="px-6 py-4 whitespace-nowrap">Judul Materi</th>
            <th class="px-6 py-4 whitespace-nowrap">Tema/Topik</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Status</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Aksi</th>
          </tr>
        </thead>

        <tbody id="sessionTableBody" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-8 h-8 animate-spin text-blue-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Sedang memuat data sesi...</span>
              </div>
            </td>
          </tr>
        </tbody>
        
      </table>
    </div>

  </div>
</div>


<!-- ===============================
     SESI BELAJAR (VERSI SEDERHANA)
=============================== -->
<div class="mt-12 mb-10 px-1">
  
  <div class="w-full max-w-5xl mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center gap-3">
      <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      </div>
      <h3 class="text-xl font-bold text-slate-800 dark:text-white">
        Sesi Belajar (Harian)
      </h3>
    </div>

    <div class="p-6 md:p-8">
      
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-8">

        <div class="md:col-span-2">
          <label class="block text-xs font-bold uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-2">
            Ke-
          </label>
          <input id="sessionOrder" type="number" placeholder="1"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 
                   bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100
                   focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
        </div>

        <div class="md:col-span-7">
          <label class="block text-xs font-bold uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-2">
            Judul Pertemuan
          </label>
          <input id="sessionTitle" type="text" placeholder="Contoh: Pertemuan 2 ‚Äì Ta‚Äôaruf"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 
                   bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100
                   focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
        </div>

        <div class="md:col-span-3">
          <label class="block text-xs font-bold uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-2">
            Status
          </label>
          <div class="relative">
            <select id="sessionActive"
              class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 
                     bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100
                     focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all appearance-none cursor-pointer">
              <option value="true">üü¢ Aktif</option>
              <option value="false">üî¥ Nonaktif</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
          </div>
        </div>

        <div class="md:col-span-12">
          <label class="block text-xs font-bold uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-2">
            Tema Kosakata
          </label>
          <div class="relative">
            <select id="sessionTheme"
              class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 
                     bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100
                     focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all appearance-none cursor-pointer">
              <option value="">-- Pilih Tema --</option>
              <option value="taaruf">Ta‚Äôaruf (Perkenalan)</option>
              <option value="keluarga">Keluarga</option>
              <option value="sekolah">Sekolah</option>
              <option value="hewan">Binatang</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
          </div>
          <p class="text-xs text-slate-400 mt-2 flex items-center gap-1">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Sistem akan memilih 5 kosakata secara acak dari tema ini.
          </p>
        </div>

      </div>

      <div class="mb-8 p-5 bg-blue-50 dark:bg-slate-700/30 rounded-xl border border-blue-100 dark:border-slate-600/50">
        <label class="flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200 mb-3">
          <span>üìù</span> Instruksi Tugas Harian
        </label>
        <textarea id="dailyTaskText" rows="3"
          class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 
                 bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-100
                 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none"
          placeholder="Contoh: Hafalkan 5 kosakata di atas dan buat 3 kalimat perkenalan diri..."></textarea>
        <p class="text-xs text-slate-400 mt-2 text-right italic">
          * Siswa akan melihat instruksi ini di dashboard mereka.
        </p>
      </div>

      <div class="pt-6 border-t border-slate-100 dark:border-slate-700 flex flex-col gap-4">
        <button id="btnSaveSession"
          class="w-full bg-emerald-600 hover:bg-emerald-700 active:scale-[0.99]
                 text-white py-3.5 rounded-xl font-bold text-lg shadow-lg shadow-emerald-500/30 
                 transition-all flex items-center justify-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
          Simpan Sesi Harian
        </button>

        <div id="sessionMsg" class="hidden animate-fade-in text-center p-3 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-sm font-medium border border-green-200 dark:border-green-800">
          ‚úÖ Sesi harian berhasil disimpan!
        </div>
      </div>

    </div>
  </div>
</div>



<!-- ================= NILAI KUIS SISWA ================= -->
<div class="mt-12 px-1">
  
  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600 dark:text-purple-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
        </div>
        <h2 class="text-xl font-bold text-slate-800 dark:text-white">
          Nilai Kuis Siswa
        </h2>
      </div>

      </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[20px]">No</th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[150px]">Nama Siswa</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas</th>
            <th class="px-6 py-4 whitespace-nowrap">Judul Kuis</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Skor</th>
            <th class="px-6 py-4 whitespace-nowrap">Waktu</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Aksi</th>
          </tr>
        </thead>

        <tbody id="nilaiTableBody" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          
          <tr>
            <td colspan="7" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-purple-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Sedang memuat data nilai...</span>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>

    <div class="px-6 py-4 bg-slate-50 dark:bg-slate-900/30 border-t border-slate-100 dark:border-slate-700">
      <p class="text-xs text-slate-400 dark:text-slate-500 text-center sm:text-left">
        Menampilkan data terbaru hasil pengerjaan kuis.
      </p>
    </div>

  </div>
</div>



<!-- ================= TOTAL POIN SISWA ================= -->
<div class="mt-12 mb-20 px-1">
  
  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex flex-col md:flex-row md:items-center justify-between gap-4">
      
      <div class="flex items-center gap-3">
        <div class="p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg text-yellow-600 dark:text-yellow-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-800 dark:text-white">
            Total Poin Siswa
          </h3>
          <p class="text-xs text-slate-400 dark:text-slate-500">Akumulasi poin aktif dan poin total.</p>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-2">
        
        <button id="resetPoinBtn"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold
                 bg-white border border-slate-300 text-slate-700 shadow-sm
                 hover:bg-slate-50 hover:text-red-600 hover:border-red-200
                 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-600 dark:hover:text-red-400
                 transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
          Reset Hari Ini
        </button>

        <button id="resetPoinTotalBtn"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold
                 bg-red-50 text-red-600 border border-red-100
                 hover:bg-red-600 hover:text-white hover:border-red-600
                 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/50 dark:hover:bg-red-600 dark:hover:text-white
                 transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          Reset Semua (Total)
        </button>
      </div>

    </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[20px]">No</th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[200px]">Nama Siswa</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas</th>
            
            <th class="px-6 py-4 text-center whitespace-nowrap bg-blue-50/50 dark:bg-blue-900/10">
              <span class="flex items-center justify-center gap-1 text-blue-600 dark:text-blue-400">
                ‚ö° Poin Aktif
              </span>
            </th>
            
            <th class="px-6 py-4 text-center whitespace-nowrap bg-purple-50/50 dark:bg-purple-900/10">
              <span class="flex items-center justify-center gap-1 text-purple-600 dark:text-purple-400">
                üèÜ Total Semua
              </span>
            </th>
          </tr>
        </thead>

        <tbody id="poinTableBody" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          
          <tr>
            <td colspan="5" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-yellow-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Sedang memuat data poin...</span>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>
    
  </div>
</div>


<!-- ================= RANKING SISWA ================= -->
<div class="mt-12 mb-24 px-1">
  
  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-600 dark:text-orange-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-800 dark:text-white">
            Ranking Siswa
          </h3>
          <p class="text-xs text-slate-400 dark:text-slate-500">Peringkat berdasarkan akumulasi total poin.</p>
        </div>
      </div>
    </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 text-center whitespace-nowrap w-[80px]">
              Rank
            </th>
            <th class="px-6 py-4 whitespace-nowrap min-w-[200px]">Nama Siswa</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas</th>
            <th class="px-6 py-4 text-center whitespace-nowrap bg-orange-50/50 dark:bg-orange-900/10">
              <span class="text-orange-600 dark:text-orange-400 font-bold">Total Poin</span>
            </th>
          </tr>
        </thead>

        <tbody id="rankingTableBody" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          
          <tr>
            <td colspan="4" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-orange-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Menghitung peringkat...</span>
              </div>
            </td>
          </tr>

        </tbody>
      </table>
    </div>
    
    <div class="px-6 py-4 bg-slate-50 dark:bg-slate-900/30 border-t border-slate-100 dark:border-slate-700">
       <p class="text-xs text-slate-400 text-center">
         * Peringkat diupdate secara realtime berdasarkan total poin.
       </p>
    </div>

  </div>
</div>




<!-- ============================= -->
<!-- CARD: DAFTAR SISWA BARU -->
<!-- ============================= -->
<div class="space-y-10 mb-20 px-1">

  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center gap-3">
      <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
      </div>
      <h3 class="text-xl font-bold text-slate-800 dark:text-white">
        Daftarkan Siswa Baru
      </h3>
    </div>

    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        
        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Nama Lengkap</label>
          <input id="inputNama" type="text" placeholder="Contoh: Ahmad Fauzan"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">NISN</label>
          <input id="inputNisn" type="text" placeholder="Nomor Induk Siswa Nasional"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Kelas</label>
          <input id="inputKelas" type="text" placeholder="Contoh: 7A"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Jenis Kelamin</label>
          <div class="relative">
            <select id="inputGender"
              class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all appearance-none cursor-pointer">
              <option value="">-- Pilih Gender --</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
          </div>
        </div>

      </div>

      <div class="mt-6">
        <button id="btnSimpanSiswa"
          class="w-full md:w-auto px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-md transition-all flex items-center justify-center gap-2">
          <span>üíæ</span> Simpan ke Database
        </button>
        <p id="infoSimpanSiswa" class="mt-3 text-sm text-slate-500"></p>
      </div>

      <div id="akunResult" class="hidden mt-6 p-5 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800/50">
        <div class="flex items-start gap-3">
          <div class="p-2 bg-emerald-100 dark:bg-emerald-800 rounded-full text-emerald-600 dark:text-emerald-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          </div>
          <div class="flex-1 space-y-1 text-sm text-slate-700 dark:text-slate-200">
            <h4 class="font-bold text-emerald-700 dark:text-emerald-400 text-lg mb-2">Akun Berhasil Dibuat!</h4>
            <div class="grid grid-cols-[80px_1fr] gap-1">
              <span class="font-semibold text-slate-500 dark:text-slate-400">Nama:</span>
              <span id="resNama" class="font-medium"></span>
              
              <span class="font-semibold text-slate-500 dark:text-slate-400">Email:</span>
              <span id="resEmail" class="font-mono bg-white dark:bg-slate-800 px-1 rounded border border-slate-200 dark:border-slate-700 w-fit"></span>
              
              <span class="font-semibold text-slate-500 dark:text-slate-400">Password:</span>
              <span id="resPassword" class="font-mono bg-white dark:bg-slate-800 px-1 rounded border border-slate-200 dark:border-slate-700 w-fit"></span>
            </div>

            <button id="btnCetakPdf" class="mt-4 px-4 py-2 bg-slate-800 dark:bg-slate-700 hover:bg-slate-900 text-white text-xs font-bold uppercase tracking-wider rounded-lg flex items-center gap-2 transition-all">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>
              Cetak PDF Bukti Pendaftaran
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center gap-3">
      <div class="p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
      </div>
      <h3 class="text-xl font-bold text-slate-800 dark:text-white">
        Manajemen E-Book
      </h3>
    </div>

    <div class="overflow-x-auto w-full">
      <table class="w-full text-sm text-left">
        <thead class="bg-slate-100 dark:bg-slate-900/80 text-xs uppercase tracking-wider font-bold text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700">
          <tr>
            <th class="px-6 py-4 whitespace-nowrap w-[20px]">No</th>
            <th class="px-6 py-4 whitespace-nowrap">Judul Buku</th>
            <th class="px-6 py-4 whitespace-nowrap">Kelas / Kategori</th>
            <th class="px-6 py-4 whitespace-nowrap">File</th>
            <th class="px-6 py-4 whitespace-nowrap">Waktu Upload</th>
            <th class="px-6 py-4 text-center whitespace-nowrap">Aksi</th>
          </tr>
        </thead>

        <tbody id="ebookTableBody" class="divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300">
          <tr>
            <td colspan="6" class="px-6 py-10 text-center text-slate-400 dark:text-slate-500 italic">
              <div class="flex flex-col items-center justify-center gap-2">
                <svg class="w-6 h-6 animate-spin text-indigo-500 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                <span>Memuat data e-book...</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <div class="w-full bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
    
    <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex items-center gap-3">
      <div class="p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
      </div>
      <h3 class="text-xl font-bold text-slate-800 dark:text-white">
        Upload E-Book Baru
      </h3>
    </div>

    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        
        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Judul (Bahasa Arab)</label>
          <input id="ebookTitleAr" type="text" placeholder="Contoh: ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ®ŸäŸÜ ŸäÿØŸäŸÉ"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all text-right" dir="rtl">
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Judul (Bahasa Indonesia)</label>
          <input id="ebookTitleId" type="text" placeholder="Contoh: Bahasa Arab untuk Pemula"
            class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all">
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">Kategori / Kelas</label>
          <div class="relative">
            <select id="ebookCategory"
              class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all appearance-none cursor-pointer">
              <option value="mts7">MTs Kelas 7</option>
              <option value="mts8">MTs Kelas 8</option>
              <option value="mts9">MTs Kelas 9</option>
              <option value="novel">Novel Arab</option>
              <option value="kisah">Kisah Islami</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
          </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 mb-1 ml-1">File PDF</label>
          <input id="ebookFile" type="file" accept="application/pdf"
            class="w-full px-3 py-2.5 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-700 dark:text-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500
                   file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-emerald-100 file:text-emerald-700 hover:file:bg-emerald-200 transition-all cursor-pointer">
        </div>

      </div>

      <div class="mt-6">
        <button id="btnUploadEbook"
          class="w-full md:w-auto px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl shadow-md transition-all flex items-center justify-center gap-2">
          <span>‚¨ÜÔ∏è</span> Upload E-Book
        </button>
        <p id="ebookUploadStatus" class="text-sm mt-3 hidden"></p>
      </div>

    </div>
  </div>

</div>


<div id="editEbookModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
  
  <div class="absolute inset-0 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 transform transition-all scale-100">
      
      <div class="px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
        <h3 class="text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2">
          <span>‚úèÔ∏è</span> Edit E-Book
        </h3>
        <button onclick="closeEditEbook()" class="text-slate-400 hover:text-slate-500 dark:hover:text-slate-300">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>

      <div class="p-6 space-y-4">
        <div>
          <label class="text-xs font-bold text-slate-500 ml-1">Judul Arab</label>
          <input id="editTitleAr" type="text" placeholder="Judul Arab"
            class="w-full mt-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-yellow-500 outline-none text-right" dir="rtl">
        </div>

        <div>
          <label class="text-xs font-bold text-slate-500 ml-1">Judul Indonesia</label>
          <input id="editTitleId" type="text" placeholder="Judul Indonesia"
            class="w-full mt-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-yellow-500 outline-none">
        </div>

        <div>
          <label class="text-xs font-bold text-slate-500 ml-1">Kategori</label>
          <div class="relative mt-1">
            <select id="editLevel"
              class="w-full px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-yellow-500 outline-none appearance-none">
              <option value="">Pilih Kategori</option>
              <option value="mts7">MTs Kelas 7</option>
              <option value="mts8">MTs Kelas 8</option>
              <option value="mts9">MTs Kelas 9</option>
              <option value="novel">Novel Arab</option>
              <option value="kisah">Kisah Islami</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
          </div>
        </div>
      </div>

      <div class="px-6 py-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3 rounded-b-2xl">
        <button onclick="closeEditEbook()"
          class="px-4 py-2 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-300 dark:border-slate-600 rounded-lg font-medium hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors">
          Batal
        </button>
        <button onclick="saveEditEbook()"
          class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-lg shadow-sm transition-colors flex items-center gap-2">
          <span>üíæ</span> Simpan
        </button>
      </div>

    </div>
  </div>
</div>


      </article>
    </section>

    

  </main>

  <!-- ===== FOOTER (PASTI NEMPEL) ===== -->
  <footer class="bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 transition-colors mt-auto">
  <div class="max-w-7xl mx-auto px-6 py-10">
    <div class="flex flex-col items-center text-center space-y-4">
      
      <div class="flex flex-col items-center gap-1 group">
        <span class="text-lg font-black tracking-tighter text-slate-800 dark:text-white uppercase italic">
          Tarbiyyat <span class="text-emerald-600 dark:text-emerald-400">al-Lughah</span>
        </span>
        <div class="flex items-center gap-2 mt-1">
          <span class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">Sistem Manajemen Pengajar</span>
        </div>
      </div>

      <div class="flex items-center gap-1.5">
        <div class="h-1 w-1 bg-emerald-500/40 rounded-full"></div>
        <div class="h-1 w-24 bg-gradient-to-r from-transparent via-emerald-500 to-transparent rounded-full"></div>
        <div class="h-1 w-1 bg-emerald-500/40 rounded-full"></div>
      </div>

      <div class="pt-2 space-y-2">
        <p class="text-[11px] md:text-sm text-slate-600 dark:text-slate-400 font-medium leading-relaxed">
          &copy; 2026 <strong>Tarbiyyat al-Lughah</strong> ‚Äî Media Pembelajaran Bahasa Arab MTs
        </p>
        
        <div class="flex flex-col items-center gap-1">
          <span class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Project Developer</span>
          <p class="text-xs md:text-sm text-slate-500 dark:text-slate-500 font-semibold italic">
            Muh. Aprizal ‚Äî <span class="text-emerald-600/80 dark:text-emerald-400/80">Mahasiswa PBA IAIN Bone</span>
          </p>
        </div>
      </div>

      <div class="mt-4 inline-flex items-center gap-2 px-3 py-1 bg-emerald-50 dark:bg-emerald-900/20 rounded-full border border-emerald-100 dark:border-emerald-800/50">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span class="text-[9px] font-black text-emerald-700 dark:text-emerald-400 uppercase tracking-tighter">Otoritas Panel Admin Aktif</span>
      </div>

    </div>
  </div>
</footer>


<!-- UNTUK CETAK -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>


<!-- MAIN LOGIKA -->
<script type="module">
/* ======================================================
   1. FIREBASE IMPORT
====================================================== */
import { initializeApp, getApps } from
  "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";

import {
  getAuth,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from
  "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  getDocs,
  getDoc,
  setDoc,
  deleteDoc,
  updateDoc,
  doc,
  addDoc,
  query,
  where,
  orderBy,
  serverTimestamp,
  onSnapshot,
} from
  "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

import {
  getDatabase,
  ref,
  onValue,
} from
  "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  import { getFunctions, httpsCallable } 
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-functions.js";

  import {
  getStorage,
  ref as storageRef,
  uploadBytes,
  getDownloadURL,
  deleteObject,
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";







/* ======================================================
   2. FIREBASE INIT
====================================================== */
const firebaseConfig = {
  apiKey: "AIzaSyAo4Hed-LHh2YIdkOE9PEinMGjG9UwAMUQ",
  authDomain: "tarbiyyat-lughah-presence.firebaseapp.com",
  projectId: "tarbiyyat-lughah-presence",
  databaseURL: "https://tarbiyyat-lughah-presence-default-rtdb.asia-southeast1.firebasedatabase.app",
  storageBucket: "tarbiyyat-lughah-presence.firebasestorage.app",
};



const app  = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);
window.db = db;

const rtdb = getDatabase(app);


/* ======================================================
   3. DOM ELEMENTS
====================================================== */
const loginSection     = document.getElementById("login-section");
const dashboardSection = document.getElementById("dashboard-section");

const emailInput    = document.getElementById("emailGuru");
const passwordInput = document.getElementById("passwordGuru");
const loginError    = document.getElementById("loginError");

const btnLogin  = document.getElementById("btnLoginGuru");
const btnLogout = document.getElementById("btnLogout");

const tabelSubmissions = document.getElementById("tabelSubmissions");
const tabelSiswa       = document.getElementById("tabelSiswa");

/* ======================================================
   4. GLOBAL STATE
====================================================== */
let dashboardLoaded = false;
// let unsubscribeLeaderboard = null;

let currentUser = null;


let dataSiswa   = [];   // cache data siswa
// let leaderboardMap = {};
let unsubUsers = null;


// -----LOAD DATA SISWA REALTIME
function listenDataSiswaRealtime() {
  if (unsubUsers) unsubUsers();

  const q = query(
    collection(db, "users"),
    where("role", "==", "student")
  );

  unsubUsers = onSnapshot(q, (snap) => {
    dataSiswa = snap.docs.map(d => ({
      uid: d.id,
      ...d.data()
    }));

    console.log("üî• DATA SISWA REALTIME:", dataSiswa);

    renderTabelSiswa(dataSiswa);
    renderPoinTable(dataSiswa);
    renderRankingFromUsers(dataSiswa); // ‚¨ÖÔ∏è INI KUNCI

    // ERROR HANDLER
    (error) => {
  console.warn("Firestore listener error:", error);
}


  });
}


/* ======================================================
   5. UI HELPER
====================================================== */
function showLogin() {
  loginSection.classList.remove("hidden");
  dashboardSection.classList.add("hidden");
}

function showDashboard() {
  loginSection.classList.add("hidden");
  dashboardSection.classList.remove("hidden");
}

// ================= STATUS SISWA REALTIME =================
function listenStudentStatus(uid, el) {
  const statusRef = ref(rtdb, `status/${uid}`);

  onValue(statusRef, (snap) => {
    if (!snap.exists()) {
      el.innerHTML = `<span class="text-slate-400 text-xs">‚óè Offline</span>`;
      return;
    }

    const data = snap.val();
    const last = data.lastChanged || 0;
    const now = Date.now();

    // ‚è±Ô∏è jika lebih dari 20 detik ‚Üí anggap offline
    if (data.state === "online" && (now - last < 20000)) {
      el.innerHTML = `<span class="text-green-500 text-xs">‚óè Online</span>`;
    } else {
      el.innerHTML = `<span class="text-slate-400 text-xs">‚óè Offline</span>`;
    }
  });
}



/* ======================================================
   6. LOGIN & AUTH GUARD
====================================================== */
btnLogin.addEventListener("click", async () => {
  loginError.classList.add("hidden");
  try {
    await signInWithEmailAndPassword(
      auth,
      emailInput.value.trim(),
      passwordInput.value.trim()
    );
  } catch {
    loginError.textContent = "Email atau password salah";
    loginError.classList.remove("hidden");
  }
});

btnLogout.addEventListener("click", async () => {
  await signOut(auth);
  dashboardLoaded = false;
  showLogin();
});

onAuthStateChanged(auth, async (user) => {
  if (!user || user.isAnonymous) {
    showLogin();
    dashboardLoaded = false;
    return;
  }

  const userRef = doc(db, "users", user.uid);
  const snap = await getDoc(userRef);

  if (!snap.exists()) {
    await setDoc(userRef, {
      email: user.email,
      role: "guru",
      createdAt: serverTimestamp()
    });
    location.reload();
    return;
  }

  if (snap.data().role !== "guru") {
    showLogin();
    dashboardLoaded = false;
    return;
  }

  const userData = snap.data();

currentUser = {
  uid: user.uid,
  email: user.email,
  nama: userData.nama || "Guru",
  role: userData.role,        // üî• INI KUNCI
  kelas: userData.kelas || ""
};

window.currentUser = currentUser;


  showDashboard();
  // loadLeaderboard();
  listenDataSiswaRealtime();
  loadEbookTable();
  // AKTIFKAN REALTIME
loadSessionsForGuruRealtime();






  if (!dashboardLoaded) {
    loadDashboard();        // TUGAS
    loadNilaiSiswa();       // NILAI KUIS
    // loadSiswa();            // DATA SISWA
  
    dashboardLoaded = true;
  }
});


/* ======================================================
   7. DASHBOARD TUGAS
====================================================== */
function loadDashboard() {
  tabelSubmissions.innerHTML = `
    <tr><td colspan="7" class="p-4 text-center">Memuat...</td></tr>
  `;

  // üî• QUERY HARUS DIDEFINISIKAN
  const q = query(
    collection(db, "submissions"),
    orderBy("createdAt", "desc")
  );

  onSnapshot(
    q,
    (snap) => {
      if (snap.empty) {
        tabelSubmissions.innerHTML = `
          <tr><td colspan="7" class="p-4 text-center">Belum ada tugas</td></tr>
        `;
        return;
      }

      tabelSubmissions.innerHTML = "";
      let no = 1;

      snap.forEach((d) => {
        const data = d.data();
        let waktu = "-";

        if (data.createdAt?.toDate) {
          waktu = data.createdAt.toDate().toLocaleString("id-ID");
        } else if (data.createdAtClient) {
          waktu = new Date(data.createdAtClient).toLocaleString("id-ID");
        }

        tabelSubmissions.innerHTML += `
          <tr class="dark:bg-slate-700 bg-slate-300">
            <td class="p-3 border">${no++}</td>
            <td class="p-3 border font-semibold">${data.nama}</td>
            <td class="p-3 border font-bold">${data.kelas}</td>
            <td class="p-3 border">${data.catatan || "-"}</td>
            <td class="p-3 border text-center">
              ${
                data.fileUrl
                  ? `<a href="${data.fileUrl}" target="_blank"
                       class="bg-blue-500 text-white px-3 py-1 rounded text-xs">
                       üìé Buka
                     </a>`
                  : "-"
              }
            </td>
            <td class="p-3 border">${waktu}</td>
            <td class="p-3 border text-center">
              <button
                onclick="hapusTugas('${d.id}', '${data.filePath || ""}')"
                class="bg-red-500 text-white px-3 py-1 rounded">
                Hapus
              </button>
            </td>
          </tr>
        `;
      });
    },
    (error) => {
      console.warn("Firestore listener error:", error);
    }
  );
}



// üåç WAJIB GLOBAL KARENA DIPANGGIL DARI HTML
window.hapusTugas = async function (docId, filePath) {
  if (!confirm("Yakin ingin menghapus tugas ini?")) return;

  try {
    // 1Ô∏è‚É£ HAPUS FILE DI STORAGE
    if (filePath) {
      const fileRef = storageRef(storage, filePath);
      await deleteObject(fileRef);
    }

    // 2Ô∏è‚É£ HAPUS DOKUMEN FIRESTORE
    await deleteDoc(doc(db, "submissions", docId));

    alert("‚úÖ Tugas berhasil dihapus");

  } catch (err) {
    console.error("HAPUS ERROR:", err);
    alert("‚ùå Gagal menghapus tugas");
  }
};






/* ======================================================
   9. MANAJEMEN SISWA
====================================================== */
async function loadSiswa() {
  const snap = await getDocs(collection(db, "users"));
  dataSiswa = [];

  snap.forEach((docu) => {
    const d = docu.data();
    if (d.role !== "student") return;
    dataSiswa.push({ uid: docu.id, ...d });
  });

  renderTabelSiswa();
}

function renderTabelSiswa() {
  tabelSiswa.innerHTML = "";
  let no = 1;

  if (!Array.isArray(dataSiswa)) return;

  dataSiswa.forEach((d) => {
    const uid = d.uid;
    const nama = d.nama || "-";
    const nisn = d.nisn || "-";
    const kelas = d.kelas || "-";
    const gender = d.gender || "-";

    const statusId = `status-${uid}`;

    tabelSiswa.innerHTML += `
      <tr class="dark:bg-slate-700 bg-slate-300">
        <td class="p-3 border font-semibold">${no++}</td>
        <td class="p-3 border font-semibold">${nama}</td>
        <td class="p-3 border font-semibold">${nisn}</td>
        <td class="p-3 border font-bold">${kelas}</td>
        <td class="p-3 border font-semibold">${gender}</td>

        <td class="p-3 border font-semibold" id="${statusId}">
          <span class="text-slate-400 text-xs">‚óè Offline</span>
        </td>

        <td class="p-3 border text-center font-semibold">
          <button onclick="hapusSiswa('${uid}')"
            class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-semibold">
            üóë Hapus
          </button>
        </td>
      </tr>
    `;

    // ‚úÖ PASANG LISTENER STATUS DI SINI
    const statusEl = document.getElementById(statusId);
    if (statusEl && uid) {
      listenStudentStatus(uid, statusEl);
    }
  });
}


window.hapusSiswa = async (uid) => {
  if (!confirm("Hapus siswa ini?")) return;

  try {
    // 1Ô∏è‚É£ HAPUS DATA SISWA
    await deleteDoc(doc(db, "users", uid));

    // 2Ô∏è‚É£ HAPUS LEADERBOARD (INI YANG HILANG)
    await deleteDoc(doc(db, "leaderboard", uid));

    // (opsional tapi bagus)
    console.log("Siswa & leaderboard terhapus:", uid);

    // 3Ô∏è‚É£ RELOAD DATA
    loadSiswa();

  } catch (err) {
    console.error("Gagal menghapus siswa:", err);
    alert("Terjadi kesalahan saat menghapus siswa");
  }
};



/* ======================================================
   10. DAFTARKAN SISWA BARU (CLOUD FUNCTION)
====================================================== */

document.getElementById("btnSimpanSiswa").addEventListener("click", async () => {

  const nama   = inputNama.value.trim();
  const nisn   = inputNisn.value.trim();
  const kelas  = inputKelas.value.trim();
  const gender = inputGender.value;

  if (!nama || !nisn || !kelas || !gender) {
    alert("Data belum lengkap");
    return;
  }

  const payload = { nama, nisn, kelas, gender };
  console.log("DATA DIKIRIM:", payload);

  try {
    // 1Ô∏è‚É£ KIRIM KE CLOUD FUNCTION
    const res = await fetch(
      "https://asia-southeast1-tarbiyyat-lughah-presence.cloudfunctions.net/createStudentAccount",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      }
    );

    // 2Ô∏è‚É£ AMBIL RESPONSE JSON
    const data = await res.json();

    if (!res.ok) {
      throw new Error(data.error || "Gagal membuat siswa");
    }

    // 3Ô∏è‚É£ TAMPILKAN HASIL AKUN
    document.getElementById("akunResult").classList.remove("hidden");
    document.getElementById("resNama").textContent     = nama;
    document.getElementById("resEmail").textContent    = data.email;
    document.getElementById("resPassword").textContent = data.password;

    // 4Ô∏è‚É£ SIAPKAN DATA PDF
    const dataPdf = {
      nama,
      nisn,
      kelas,
      email: data.email,
      password: data.password
    };

    // 5Ô∏è‚É£ CETAK PDF SAAT TOMBOL DIKLIK
    document.getElementById("btnCetakPdf").onclick = () => {
      generateAkunPdf(dataPdf);
    };

    // 6Ô∏è‚É£ RESET FORM
    inputNama.value = "";
    inputNisn.value = "";
    inputKelas.value = "";
    inputGender.value = "";

  } catch (err) {
    console.error(err);
    alert("‚ùå " + err.message);
  }
});


// ================= NILAI SISWA REALTIME =================
function loadNilaiSiswa() {
  const tbody = document.getElementById("nilaiTableBody");

  const q = query(
    collection(db, "quizResults"),
    orderBy("createdAt", "desc")
  );

  onSnapshot(q, (snapshot) => {
    tbody.innerHTML = "";

    if (snapshot.empty) {
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-slate-500">
            Belum ada data nilai
          </td>
        </tr>
      `;
      return;
    }

    // ERROR HANDLER
    (error) => {
    console.warn("Firestore listener error:", error);
    }



    let no = 1;
    snapshot.forEach((doc) => {
      const d = doc.data();
      const waktu = d.createdAt?.toDate
        ? d.createdAt.toDate().toLocaleString("id-ID")
        : "-";

      tbody.innerHTML += `
        <tr class="border-t border-slate-200 dark:border-slate-500 dark:bg-slate-700 bg-slate-300"">
          <td class="px-3 py-2 font-semibold">${no++}</td>
          <td class="px-3 py-2 font-semibold">${d.nama}</td>
          <td class="px-3 py-2 font-semibold">${d.kelas}</td>
          <td class="px-3 py-2 font-semibold">${d.quizTitle}</td>
          <td class="px-3 py-2 text-center font-bold">
            ${d.score} / ${d.totalSoal}
          </td>
          <td class="px-3 py-2 font-semibold">${waktu}</td>
          <td class="text-center">
            <button
            onclick="hapusNilai('${doc.id}')"
            class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs">
            üóë Hapus
            </button>
          </td>
        </tr>
      `;
    });
  });
}

// RENDER TOTAL POIN
function renderPoinTable() {
  const tbody = document.getElementById("poinTableBody");
  if (!tbody) return;

  tbody.innerHTML = "";
  let no = 1;

  dataSiswa.forEach(s => {
    tbody.innerHTML += `
      <tr class="dark:bg-slate-700 bg-slate-300">
        <td class="p-3 border font-bold">${no++}</td>
        <td class="p-3 border font-semibold">${s.nama}</td>
        <td class="p-3 border font-bold">${s.kelas}</td>
        <td class="p-3 border text-center font-bold">-</td>
        <td class="p-3 border text-center font-bold">
          ${s.poinTotal ?? 0}
        </td>
      </tr>
    `;
  });
}

// ===============================
// RENDER RANKING SISWA
// ===============================
function renderRankingFromUsers(users) {
  const tbody = document.getElementById("rankingTableBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!Array.isArray(users) || users.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="4" class="text-center py-4 text-slate-500">
          Belum ada data ranking
        </td>
      </tr>`;
    return;
  }

  const sorted = [...users].sort(
    (a, b) => (Number(b.poinTotal) || 0) - (Number(a.poinTotal) || 0)
  );

  sorted.forEach((u, i) => {
    tbody.innerHTML += `
      <tr class="dark:bg-slate-700 bg-slate-300">
        <td class="p-3 border text-center font-bold">${i + 1}</td>
        <td class="p-3 border font-semibold">${u.nama ?? "-"}</td>
        <td class="p-3 border font-bold">${u.kelas ?? "-"}</td>
        <td class="p-3 border text-center font-bold">
          ${u.poinTotal ?? 0}
        </td>
      </tr>
    `;
  });
}


console.log("DATA SISWA:", dataSiswa);



// RESET POIN
const resetBtn = document.getElementById("resetPoinBtn");

resetBtn.addEventListener("click", async () => {
  const yakin = confirm(
    "Yakin reset poin hari ini?\n\n" +
    "‚úî Poin aktif akan di-reset\n" +
    "‚úñ Total sepanjang waktu tetap"
  );

  if (!yakin) return;

  try {
    const snapshot = await getDocs(collection(db, "users"));

    for (const docSnap of snapshot.docs) {
      const data = docSnap.data();

      // hanya reset siswa
      if (data.role === "student") {
        await updateDoc(doc(db, "users", docSnap.id), {
          poin: 0
        });
      }
    }

    alert("‚úÖ Poin hari ini berhasil di-reset!");
  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal reset poin");
  }
});

// ================= RESET TOTAL POIN SEPANJANG WAKTU =================
const resetTotalBtn = document.getElementById("resetPoinTotalBtn");

resetTotalBtn.addEventListener("click", async () => {
  if (!confirm("Reset SEMUA poin siswa?")) return;

  try {
    const snapshot = await getDocs(
      query(collection(db, "users"), where("role", "==", "student"))
    );

    for (const u of snapshot.docs) {
      await updateDoc(doc(db, "users", u.id), {
        poin: 0,
        poinTotal: 0
      });
    }

    alert("‚úÖ Semua poin siswa berhasil di-reset total!");
  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal reset total poin");
  }
});




// FITUR HAPUS HASIL 
window.hapusNilai = async function (docId) {
  const yakin = confirm(
    "Yakin hapus data nilai ini?\n\n" +
    "‚ùó Data yang dihapus tidak bisa dikembalikan."
  );

  if (!yakin) return;

  try {
    await deleteDoc(doc(db, "quizResults", docId));
    alert("‚úÖ Data nilai berhasil dihapus");
  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal menghapus data");
  }
};



// UNTUK MENCETAK KARTU SISWA
function generateAkunPdf(data) {
  const { jsPDF } = window.jspdf;
  // Orientasi Portrait, Satuan mm, Ukuran A4
  const doc = new jsPDF('p', 'mm', 'a4'); 

  // --- 1. SETTING HALAMAN & BORDER ---
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  
  // Buat border ganda (tebal di luar, tipis di dalam)
  doc.setLineWidth(1);
  doc.rect(5, 5, pageWidth - 10, pageHeight - 10); // Border luar
  doc.setLineWidth(0.3);
  doc.rect(7, 7, pageWidth - 14, pageHeight - 14); // Border dalam

  // --- 2. KOP SURAT (HEADER) ---
  // Placeholder Logo (Lingkaran) - Nanti bisa diganti doc.addImage()
  doc.setFillColor(200, 200, 200); // Warna abu-abu
  doc.circle(25, 25, 12, 'F'); // Lingkaran dummy logo
  doc.setFontSize(8);
  doc.text("Logo", 25, 26, { align: "center" });

  // Teks Kop Surat
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.text("INSTITUT AGAMA ISLAM BONE", 105, 22, { align: "center" });
  
  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);
  doc.text("Media Pembelajaran Bahasa Arab - Tarbiyyat al-Lughah", 105, 29, { align: "center" });
  
  doc.setFontSize(10);
  doc.text("Alamat: Kampus IAI Bone, Jl. Cempalagi, Watampone", 105, 35, { align: "center" });

  // Garis Pembatas Kop (Double Line)
  doc.setLineWidth(1);
  doc.line(15, 42, 195, 42); // Garis tebal
  doc.setLineWidth(0.5);
  doc.line(15, 44, 195, 44); // Garis tipis

  // --- 3. JUDUL DOKUMEN ---
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text("LEMBAR AKUN SISWA", 105, 60, { align: "center" });
  doc.setLineWidth(0.5);
  doc.line(75, 62, 135, 62); // Garis bawah judul pendek

  // --- 4. DATA SISWA (TABEL) ---
  let startY = 80;
  const colLabel = 40;
  const colSep = 80;
  const colVal = 85;
  const lineHeight = 10;

  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");

  // Fungsi helper untuk baris data
  const printRow = (label, value, isBold = false) => {
    doc.setFont("helvetica", isBold ? "bold" : "normal");
    doc.text(label, colLabel, startY);
    doc.text(":", colSep, startY);
    doc.text(value ? value.toString() : "-", colVal, startY);
    startY += lineHeight;
  };

  printRow("Nama Lengkap", data.nama, true); // Bold nama
  printRow("NISN", data.nisn);
  printRow("Kelas", data.kelas);

  // --- 5. KOTAK KREDENSIAL (EMAIL & PASS) ---
  // Membuat kotak background agar info login menonjol
  startY += 5;
  doc.setDrawColor(0);
  doc.setFillColor(245, 245, 245); // Abu-abu sangat muda
  doc.roundedRect(30, startY, 150, 40, 3, 3, 'FD'); // FD = Fill & Draw

  startY += 12;
  // Di dalam kotak
  doc.setFont("courier", "bold"); // Pakai font monospaced biar jelas hurufnya
  doc.setTextColor(50, 50, 50);
  
  doc.text("Email Login", 40, startY);
  doc.text(`:  ${data.email}`, 90, startY);
  
  startY += 12;
  doc.text("Password Awal", 40, startY);
  doc.text(`:  ${data.password}`, 90, startY);

  // Reset Font
  doc.setFont("helvetica", "normal");
  doc.setTextColor(0, 0, 0);
  startY += 30; // Keluar dari kotak

  // --- 6. CATATAN PENTING ---
  doc.setFontSize(10);
  doc.setFont("helvetica", "italic");
  doc.text("CATATAN PENTING:", 30, startY);
  startY += 6;
  
  const notes = [
    "1. Password di atas hanya untuk siswa, jadi tidak bisa di pakai untuk login di tempat lain.",
    "2. Simpan dokumen ini dengan baik dan jangan berikan password kepada orang lain.",
    "3. Jika mengalami kendala login, segera hubungi admin/guru bahasa Arab."
  ];

  notes.forEach(note => {
    doc.text(note, 30, startY);
    startY += 5;
  });

  // --- 7. FOOTER & TANDA TANGAN ---
  const dateStr = new Date().toLocaleDateString("id-ID", {
    day: 'numeric', month: 'long', year: 'numeric'
  });
  
  const signY = 220;
  
  // Kolom Tanda Tangan (Kanan Bawah)
  doc.setFont("helvetica", "normal");
  doc.text(`Watampone, ${dateStr}`, 140, signY);
  doc.text("Mengetahui,", 140, signY + 6);
  doc.setFont("helvetica", "bold");
  doc.text("Guru Pengampu", 140, signY + 12);
  
  // Space Tanda Tangan
  doc.text("( ___________________ )", 140, signY + 35);

  // Info Cetak di paling bawah
  doc.setFontSize(8);
  doc.setFont("helvetica", "italic");
  doc.text(`Dicetak otomatis oleh Sistem Pembelajaran Bahasa Arab pada ${new Date().toLocaleString("id-ID")}`, pageWidth/2, pageHeight - 10, {align: "center"});

  // Simpan File
  const fileName = `akun-siswa-${data.nama}-${data.kelas}.pdf`.replace(/\s+/g, "_");
  doc.save(fileName);
}



// ===============================
// LOGIC UPLOAD PDF BOOKS (FINAL)
// ===============================
const storage = getStorage();

document.getElementById("btnUploadEbook").onclick = async () => {
  const titleAr  = ebookTitleAr.value.trim();
  const titleId  = ebookTitleId.value.trim();
  const category = ebookCategory.value;
  const file     = ebookFile.files[0];
  const statusEl = ebookUploadStatus;

  if (!titleAr || !titleId || !file) {
    alert("Lengkapi semua data");
    return;
  }

  if (!currentUser) {
    alert("User belum login");
    return;
  }

  try {
    statusEl.textContent = "‚è≥ Mengupload PDF...";
    statusEl.className = "text-blue-500";
    statusEl.classList.remove("hidden");

    // ===============================
    // 1Ô∏è‚É£ SET ID & PATH (PENTING)
    // ===============================
    const ebookId   = Date.now().toString();

    const pdfPath   = `ebooks/${category}/${ebookId}.pdf`;
    const coverPath = `ebooks/covers/${ebookId}.png`;

    // ===============================
    // 2Ô∏è‚É£ UPLOAD PDF
    // ===============================
    const pdfRef = storageRef(storage, pdfPath);
    await uploadBytes(pdfRef, file);
    const pdfUrl = await getDownloadURL(pdfRef);

    // ===============================
    // 3Ô∏è‚É£ GENERATE COVER (PDF.JS)
    // ===============================
    const pdfData = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
    const page = await pdf.getPage(1);

    const viewport = page.getViewport({ scale: 1.5 });
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width  = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;

    const blob = await new Promise(resolve =>
      canvas.toBlob(resolve, "image/png")
    );

    // ===============================
    // 4Ô∏è‚É£ UPLOAD COVER
    // ===============================
    statusEl.textContent = "‚è≥ Mengupload cover...";
    const coverRef = storageRef(storage, coverPath);
    await uploadBytes(coverRef, blob);
    const coverUrl = await getDownloadURL(coverRef);

    // ===============================
    // 5Ô∏è‚É£ SIMPAN METADATA (FINAL)
    // ===============================
    await addDoc(collection(db, "ebooks"), {
      title_ar: titleAr,
      title_id: titleId,
      category,
      level: ebookCategory.options[ebookCategory.selectedIndex].text,

      // URL (untuk dibuka)
      fileUrl: pdfUrl,
      coverUrl,

      // üî• PATH (UNTUK HAPUS)
      filePath: pdfPath,
      coverPath: coverPath,

      uploadedBy: currentUser.uid,
      createdAt: serverTimestamp()
    });

    statusEl.textContent = "‚úÖ E-Book berhasil diupload";
    statusEl.className = "text-green-600";

    // reset form
    ebookTitleAr.value = "";
    ebookTitleId.value = "";
    ebookFile.value = "";

  } catch (err) {
    console.error(err);
    statusEl.textContent = "‚ùå Gagal upload e-book";
    statusEl.className = "text-red-500";
  }
};



/* ===============================
   LOAD EBOOK ADMIN
================================ */
async function loadEbookTable() {
  const tbody = document.getElementById("ebookTableBody");
  if (!tbody) return;

  tbody.innerHTML = `
    <tr>
      <td colspan="6" class="text-center py-4 dark:text-slate-400 text-slate-600">
        Memuat e-book...
      </td>
    </tr>
  `;

  try {
    const q = query(
      collection(db, "ebooks"),
      orderBy("createdAt", "desc")
    );

    const snap = await getDocs(q);
    tbody.innerHTML = "";

    if (snap.empty) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="text-center py-4 text-slate-400">
            Belum ada e-book
          </td>
        </tr>
      `;
      return;
    }

    let no = 1;
    snap.forEach(docSnap => {
      const e = docSnap.data();
      const id = docSnap.id;

      tbody.innerHTML += `
        <tr class="hover:dark:bg-slate-700 hover:bg-slate-400">
          <td class="border px-3 py-2 text-center">${no++}</td>

          <td class="border px-3 py-2">
            <div class="font-semibold">${e.title_ar}</div>
            <div class="text-xs dark:text-slate-400 text-slate-500">${e.title_id}</div>
          </td>

          <td class="border px-3 py-2 text-center">
            ${e.level || "-"}
          </td>

          <td class="border px-3 py-2 text-center">
            <a href="${e.fileUrl}" target="_blank"
               class="dark:text-blue-400 hover:underline">
              üìÑ PDF
            </a>
          </td>

          <td class="border px-3 py-2 text-xs text-center">
            ${e.createdAt?.toDate
              ? e.createdAt.toDate().toLocaleString("id-ID")
              : "-"}
          </td>

          <td class="border px-3 py-2 text-center space-x-1">
            <button
              onclick="openEditEbook('${id}')"
              class="bg-yellow-500 hover:bg-yellow-600 text-black px-2 py-1 rounded text-xs">
              ‚úèÔ∏è Edit
            </button>


            <button
              onclick="deleteEbook('${id}')"
              class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs">
              üóë Hapus
            </button>
          </td>
        </tr>
      `;
    });

  } catch (err) {
    console.error(err);
    tbody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center py-4 text-red-400">
          Gagal memuat e-book
        </td>
      </tr>
    `;
  }
}

loadEbookTable();

/* ===============================
   HAPUS E-BOOK (FIRESTORE + STORAGE)
================================= */
window.deleteEbook = async function (ebookId) {
  const ok = confirm("Yakin ingin menghapus e-book ini?");
  if (!ok) return;

  try {
    // 1Ô∏è‚É£ Ambil data ebook dulu
    const ebookRef = doc(db, "ebooks", ebookId);
    const snap = await getDoc(ebookRef);

    if (!snap.exists()) {
      alert("Data e-book tidak ditemukan");
      return;
    }

    const ebook = snap.data();

    // 2Ô∏è‚É£ Hapus PDF dari Storage
    if (ebook.filePath) {
      const pdfRef = storageRef(storage, ebook.filePath);
      await deleteObject(pdfRef);
    }

    // 3Ô∏è‚É£ Hapus cover dari Storage
    if (ebook.coverPath) {
      const coverRef = storageRef(storage, ebook.coverPath);
      await deleteObject(coverRef);
    }

    // 4Ô∏è‚É£ Hapus dokumen Firestore
    await deleteDoc(ebookRef);

    alert("‚úÖ E-book berhasil dihapus");

    // 5Ô∏è‚É£ Reload tabel
    loadEbookTable();

  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal menghapus e-book");
  }
};

// EDIT BUKU
let EDIT_ID = null;

const editEbookModal = document.getElementById("editEbookModal");
const editTitleAr = document.getElementById("editTitleAr");
const editTitleId = document.getElementById("editTitleId");
const editLevel = document.getElementById("editLevel");

/* ===============================
   OPEN EDIT
================================ */
window.openEditEbook = async (id) => {
  try {
    const snap = await getDoc(doc(db, "ebooks", id));
    if (!snap.exists()) {
      alert("E-book tidak ditemukan");
      return;
    }

    const e = snap.data();

    EDIT_ID = id;
    editTitleAr.value = e.title_ar || "";
    editTitleId.value = e.title_id || "";
    editLevel.value = e.level || "";

    editEbookModal.classList.remove("hidden");

  } catch (err) {
    console.error(err);
    alert("Gagal membuka edit e-book");
  }
};

/* ===============================
   SAVE EDIT
================================ */
window.saveEditEbook = async () => {
  if (!EDIT_ID) return;

  if (!editTitleAr.value || !editTitleId.value || !editLevel.value) {
    alert("Lengkapi semua field");
    return;
  }

  try {
    await updateDoc(doc(db, "ebooks", EDIT_ID), {
      title_ar: editTitleAr.value.trim(),
      title_id: editTitleId.value.trim(),
      level: editLevel.value
    });

    closeEditEbook();
    loadEbookTable(); // ‚¨ÖÔ∏è refresh tabel e-book

  } catch (err) {
    console.error(err);
    alert("Gagal menyimpan perubahan");
  }
};

/* ===============================
   CANCEL / CLOSE
================================ */
window.closeEditEbook = () => {
  EDIT_ID = null;
  editEbookModal.classList.add("hidden");
};


// LOGIC SIMPAN SESI BELAJAR (VERSI BARU - HARIAN)
const btnSaveSession = document.getElementById("btnSaveSession");
const msg = document.getElementById("sessionMsg");

btnSaveSession.addEventListener("click", async () => {
  const order = Number(document.getElementById("sessionOrder").value);
  const title = document.getElementById("sessionTitle").value.trim();
  const theme = document.getElementById("sessionTheme").value;
  const dailyTaskText =
    document.getElementById("dailyTaskText").value.trim();

  const isActive =
    document.getElementById("sessionActive").value === "true";

  // VALIDASI MINIMAL (WAJIB)
  if (!order || !title || !theme) {
    alert("Pertemuan, judul, dan tema wajib diisi");
    return;
  }

  try {
    await addDoc(collection(db, "learningSessions"), {
      order,
      title,
      theme,
      dailyTaskText,
      isActive,
      createdAt: serverTimestamp()
    });

    // pesan sukses
    msg.classList.remove("hidden");
    msg.textContent = "Sesi harian berhasil disimpan";

    // reset form
    document.querySelectorAll(
      "#sessionOrder, #sessionTitle, #sessionTheme, #dailyTaskText"
    ).forEach(el => el.value = "");

    document.getElementById("sessionActive").value = "true";

  } catch (err) {
    console.error(err);
    alert("Gagal menyimpan sesi");
  }
});





// LOAD DATA SESI BELAJAR (REALTIME)
const sessionTableBody = document.getElementById("sessionTableBody");

function loadSessionsForGuruRealtime() {
  sessionTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="px-3 py-4 text-center text-slate-400">
        Memuat data sesi...
      </td>
    </tr>
  `;

  try {
    const q = query(
      collection(db, "learningSessions"),
      orderBy("order", "asc")
    );

    onSnapshot(q, (snap) => {
      if (snap.empty) {
        sessionTableBody.innerHTML = `
          <tr>
            <td colspan="5" class="px-3 py-4 text-center text-slate-400">
              Belum ada sesi
            </td>
          </tr>
        `;
        return;
      }

      sessionTableBody.innerHTML = "";

      snap.forEach(docSnap => {
        const s = docSnap.data();
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td class="px-3 py-2">${s.order}</td>
          <td class="px-3 py-2 font-medium">${s.title}</td>
          <td class="px-3 py-2 capitalize">${s.theme}</td>

          <td class="px-3 py-2 text-center">
            <button
              class="toggleStatus px-3 py-1 rounded-full text-xs font-semibold
                ${s.isActive ? "bg-green-600" : "bg-slate-600"}"
              data-id="${docSnap.id}"
              data-active="${s.isActive}">
              ${s.isActive ? "Aktif" : "Nonaktif"}
            </button>
          </td>

          <td class="px-3 py-2 text-center">
            <button
              class="deleteSession text-red-400 hover:text-red-600"
              data-id="${docSnap.id}">
              üóë Hapus
            </button>
          </td>
        `;

        sessionTableBody.appendChild(tr);
      });
    });

  } catch (err) {
    console.error(err);
    sessionTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="px-3 py-4 text-center text-red-500">
          Gagal memuat data sesi
        </td>
      </tr>
    `;
  }
}


// TOMBOL ON/OFF SESI BELAJAR
document.addEventListener("click", async (e) => {
  const btn = e.target.closest(".toggleStatus");
  if (!btn) return;

  const id = btn.dataset.id;
  const current = btn.dataset.active === "true";
  const newStatus = !current;

  btn.disabled = true;
  btn.textContent = "Menyimpan...";

  try {
    await updateDoc(doc(db, "learningSessions", id), {
      isActive: newStatus
    });
    // TIDAK perlu ubah UI manual
    // onSnapshot() akan update UI otomatis

  } catch (err) {
    console.error(err);
    alert("Gagal mengubah status sesi");
  } finally {
    btn.disabled = false;
  }
});



</script>



<!-- JS DARK MODE -->
<script>
const html = document.documentElement;
const toggle = document.getElementById("darkToggle");

// cek preferensi awal
if (localStorage.theme === "dark") {
  html.classList.add("dark");
  toggle.textContent = "‚òÄÔ∏è";
}

// toggle klik
toggle.addEventListener("click", () => {
  html.classList.toggle("dark");

  if (html.classList.contains("dark")) {
    localStorage.theme = "dark";
    toggle.textContent = "‚òÄÔ∏è";
  } else {
    localStorage.theme = "light";
    toggle.textContent = "üåô";
  }
});
</script>

  <!-- Aktifkan mode global (1 angka untuk seluruh situs) -->
<script>
  window.PRESENCE_OPTIONS = { mode: "global" };
</script>

<!-- Panggil script presence -->
<script type="module" src="./assets/presence.js"></script>

<!-- PALING BAWAH, sebelum </body> -->
<script type="module" src="./assets/discussion.js"></script>

</body>
</html>
