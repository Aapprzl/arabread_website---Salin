<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Ganti Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 flex items-center justify-center min-h-screen">

  <div class="bg-slate-800 p-6 rounded-lg w-full max-w-sm">
    <h2 class="text-white text-xl font-bold mb-4 text-center">
      Ganti Password
    </h2>

    <p class="text-slate-300 text-sm mb-4 text-center">
      Demi keamanan, silakan ganti password Anda.
    </p>

    <input
      type="password"
      id="newPassword"
      placeholder="Password Baru"
      class="w-full p-2 rounded mb-3 bg-slate-700 text-white"
    />

    <button
      id="btnSave"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded"
    >
      Simpan Password
    </button>

    <p id="msg" class="text-sm text-center mt-3"></p>
  </div>

  <script type="module">
    import { getAuth, updatePassword } from
      "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, doc, updateDoc } from
      "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAo4Hed-LHh2YIdkOE9PEinMGjG9UwAMUQ",
  authDomain: "tarbiyyat-lughah-presence.firebaseapp.com",
  projectId: "tarbiyyat-lughah-presence",
  databaseURL: "https://tarbiyyat-lughah-presence-default-rtdb.asia-southeast1.firebasedatabase.app",
};

    
    const auth = getAuth(app);
    const db = getFirestore(app);

    const btn = document.getElementById("btnSave");
    const msg = document.getElementById("msg");

    btn.onclick = async () => {
      const user = auth.currentUser;
      const newPass = document.getElementById("newPassword").value;

      if (!newPass || newPass.length < 6) {
        msg.textContent = "Password minimal 6 karakter";
        msg.className = "text-red-400";
        return;
      }

      try {
        await updatePassword(user, newPass);

        await updateDoc(doc(db, "users", user.uid), {
          mustChangePassword: false
        });

        alert("Password berhasil diganti!");
        window.location.href = "dashboard-siswa.html";
      } catch (err) {
        msg.textContent = err.message;
        msg.className = "text-red-400";
      }
    };
  </script>

  <script type="module" src="assets/js/ganti-password.js"></script>


</body>
</html>
